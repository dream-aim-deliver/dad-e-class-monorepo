// Auto-generated by page-scaffold command v2
// Notion: https://www.notion.so/CMS-Single-user-Manage-Users-13a5a7432d018065bea7fcc7370b0adf
// Usecases: getPersonalProfile, getProfessionalProfile, listStudentCourses, listCoachReviews, listUserRoles, listCoachCourses, updateUserRoles
// Features: Personal Profile, Professional Profile, Student Courses, Coach Courses, Coach Reviews, User Roles Management
// User Types: CMS (admin/superadmin)

import { HydrateClient, prefetch, getServerTRPC } from '../config/trpc/cms-server';
import { Suspense } from 'react';
import DefaultLoadingWrapper from '../../client/wrappers/default-loading';
import SingleUser from '../../client/pages/single-user';
import { TLocale } from '@maany_shr/e-class-translations';

interface SingleUserServerComponentProps {
  locale: TLocale;
  platformSlug: string;
  platformLocale: TLocale;
  username: string;
}

export default async function SingleUserServerComponent(
  props: SingleUserServerComponentProps
) {
  const trpc = getServerTRPC({
    platform_locale: props.platformLocale,
    platform_slug: props.platformSlug,
  });

  // Streaming pattern: Fire prefetches without awaiting (TSK-PERF-007)
  // React will stream HTML while queries are pending

  prefetch(trpc.getCoachApplication.queryOptions({
    username: props.username,
  }));

  // Only prefetch essential queries for role management
  prefetch(trpc.listUserRoles.queryOptions({
    username: props.username
  }));
  prefetch(trpc.getPersonalProfile.queryOptions({
    username: props.username,
  }));

  prefetch(trpc.listStudentCourses.queryOptions({
    studentUsername: props.username,
  }));
  prefetch(trpc.getProfessionalProfile.queryOptions({
    username: props.username,
  }));
  prefetch(trpc.listCoachReviews.queryOptions({
    coachUsername: props.username,
  }));
  prefetch(trpc.listCoachCourses.queryOptions({
    forStudent: false,
    coachUsername: props.username,
  }));

  return (
    <HydrateClient>
      <Suspense fallback={<DefaultLoadingWrapper />}>
        <SingleUser
          locale={props.locale}
          platformSlug={props.platformSlug}
          platformLocale={props.platformLocale}
          username={props.username}
        />
      </Suspense>
    </HydrateClient>
  );
}
