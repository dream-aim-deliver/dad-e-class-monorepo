// Auto-generated by page-scaffold command v2
// Notion: https://www.notion.so/Activity-history-Notifications-Page-2245a7432d01800e8e33d5d245ae9c4e
// Usecases: listNotifications, markNotificationsAsRead
// Features: FEAT-5 (listNotifications), FEAT-95 (markNotificationsAsRead)
// UI Components: NotificationGrid (already exists)
// User Types: accessible to all logged-in users
// Comment: Activity history view uses the already made NotificationGrid

import { HydrateClient, prefetch, trpc } from '../config/trpc/cms-server';
import { Suspense } from 'react';
import DefaultLoadingWrapper from '../../client/wrappers/default-loading';
import ActivityHistory from '../../client/pages/activity-history';
import { TLocale } from '@maany_shr/e-class-translations';
import getSession from '../config/auth/get-session';
import { redirect } from 'next/navigation';

interface ActivityHistoryServerComponentProps {
  locale: TLocale;
}

export default async function ActivityHistoryServerComponent(
  props: ActivityHistoryServerComponentProps
) {
  const session = await getSession();

  if (!session || !session.user) {
    redirect('/auth/login');
  }

  await Promise.all([
    prefetch(trpc.listNotifications.queryOptions({})),
  ]);

  return (
    <HydrateClient>
      <Suspense fallback={<DefaultLoadingWrapper />}>
        <ActivityHistory locale={props.locale} />
      </Suspense>
    </HydrateClient>
  );
}
