// Auto-generated by page-scaffold command
// TSK: TSK-1
// Features: listTopics, getProfessionalProfile, saveProfessionalProfile
// Route: /workspace/profile

import { HydrateClient, trpc, prefetch } from '../config/trpc/cms-server';
import { Suspense } from 'react';
import { DefaultLoading } from '@maany_shr/e-class-ui-kit';
import Profile from '../../client/pages/profile';
import getSession from '../config/auth/get-session';
import { redirect } from 'next/navigation';

interface ProfileProps {
	locale: string;
}

export default async function ProfileServerComponent(props: ProfileProps) {
	const session = await getSession();

	if (!session || !session.user) {
		redirect('/auth/login');
	}

	const userEmail = session.user.email || '';
	const username = session.user.name || '';
	const roles = session.user.roles || [];

	// Streaming pattern: Fire prefetches without awaiting (TSK-PERF-007)
	// React will stream HTML while queries are pending
	prefetch(trpc.getPersonalProfile.queryOptions({}));
	prefetch(trpc.listLanguages.queryOptions({ queryType: "all" }));
	prefetch(trpc.getProfessionalProfile.queryOptions({}));

	return (
		<>
			<HydrateClient>
				<Suspense fallback={<DefaultLoading locale={props.locale as any} variant="minimal" />}>
					<Profile locale={props.locale} userEmail={userEmail} username={username} roles={roles} />
				</Suspense>
			</HydrateClient>
		</>
	);
}
