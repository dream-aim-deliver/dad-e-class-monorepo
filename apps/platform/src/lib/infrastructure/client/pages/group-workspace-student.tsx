'use client';

// Auto-generated by page-scaffold command v2
// Usecases: getGroupNotes, listGroupAssignments, listGroupMembers, getGroupNextCoachingSession
// Features: Group notes tracking, assignments tracking, member management, coaching session tracking
// User Types: Student
// Figma: https://www.figma.com/design/8KEwRuOoD5IgxTtFAtLlyS/Just_Do_Ad-1.2?node-id=6913-292532

import { useState } from 'react';
import { TLocale } from '@maany_shr/e-class-translations';
import { trpc } from '../trpc/cms-client';
import { DefaultLoading, DefaultError, DefaultNotFound, Breadcrumbs, GroupIntroduction, Button, CoachNotesView, Dropdown, IconFilter, AssignmentCard, AssignmentCardFilterModal, TextInput, IconSearch, StudentCardList, StudentCard, CoachNotesEditDialog, IconEdit, CoachingSessionGroupOverviewCard } from '@maany_shr/e-class-ui-kit';
import { useLocale, useTranslations } from 'next-intl';
import { useSession } from 'next-auth/react';
import { useRouter } from 'next/navigation';
import { viewModels } from '@maany_shr/e-class-models';
import { useGetGroupIntroductionPresenter } from '../hooks/use-get-group-introduction-presenter';
import { useGetGroupNotesPresenter } from '../hooks/use-get-group-notes-presenter';
import { useGetGroupNextCoachingSessionPresenter } from '../hooks/use-get-group-next-coaching-session-presenter';
import { useListGroupAssignmentsPresenter } from '../hooks/use-list-group-assignments-presenter';
import { useListGroupMembersPresenter } from '../hooks/use-list-group-members-presenter';

interface GroupWorkspaceStudentProps {
  locale: TLocale;
  courseSlug: string;
  groupId: number;
}

export default function GroupWorkspaceStudent({
  locale,
  courseSlug,
  groupId,
}: GroupWorkspaceStudentProps) {
  const currentLocale = useLocale() as TLocale;
  const router = useRouter();
  const t = useTranslations('pages.groupWorkspaceCoach');
  const breadcrumbsTranslations = useTranslations('components.breadcrumbs');

  // Sorting state
  const [sortBy, setSortBy] = useState<string>('title');
  const [search, setSearch] = useState<string>('');

  // Filter state
  const [filters, setFilters] = useState<{
    title?: string;
    status?: string[];
    course?: string;
    module?: string;
    lesson?: string;
    student?: string;
    groupName?: string;
  }>({});
  const [showFilterModal, setShowFilterModal] = useState(false);

  // Sort handler
  const handleSortChange = (selected: string | string[] | null) => {
    if (typeof selected === 'string') {
      setSortBy(selected);
    }
  };

  // Sort options for dropdown
  const sortOptions = [
    { value: 'title', label: t('assignments.sortOptions.title') },
    { value: 'status', label: t('assignments.sortOptions.status') },
    { value: 'date', label: t('assignments.sortOptions.date') },
    { value: 'student', label: t('assignments.sortOptions.student') },
  ];

  // Filter handler
  const handleApplyFilters = (newFilters: typeof filters) => {
    setFilters(newFilters);
    setShowFilterModal(false);
  };

  // Authentication using Pattern B (Student role only)
  const sessionDTO = useSession();
  const session = sessionDTO.data;
  const isStudent = session?.user?.roles?.includes('student');

  if (!isStudent) {
    return (
      <DefaultError
        locale={currentLocale}
        title={t('error.accessDenied.title')}
        description={t('error.accessDenied.description')}
      />
    );
  }

  // TRPC queries for page data
  // TODO: Replace with actual usecases from: saveGroupNotes, getGroupNotes, listGroupAssignments, listGroupMembers, getGroupNextCoachingSession

  // Fetch group introduction from getGroupIntroduction usecase
  const [groupIntroductionResponse] = trpc.getGroupIntroduction.useSuspenseQuery({
    courseSlug: courseSlug,
    additionalParams: {
      requestType: 'requestForStudent',
    }
  });

  // Fetch group notes from getGroupNotes usecase
  const [groupNotesResponse] = trpc.getGroupNotes.useSuspenseQuery({
    courseSlug: courseSlug,
    additionalParams: {
        requestType: 'requestForStudent',
    }
  });

  // Fetch next coaching session from getGroupNextCoachingSession usecase
  const [nextSessionResponse] = trpc.getGroupNextCoachingSession.useSuspenseQuery({
    courseSlug: courseSlug,
    additionalParams: {
      requestType: 'requestForStudent',
    }
  });

  // Fetch group assignments from listGroupAssignments usecase
  const [assignmentsResponse] = trpc.listGroupAssignments.useSuspenseQuery({
    courseSlug: courseSlug,
    additionalParams: {
      requestType: 'requestForStudent',
    }
  });

  // Fetch group members from listGroupMembers usecase
  const [membersResponse] = trpc.listGroupMembers.useSuspenseQuery({
    courseSlug: courseSlug,
    additionalParams: {
      requestType: 'requestForStudent',
    }
  });

  const [groupIntroductionViewModel, setGroupIntroductionViewModel] = useState<
    viewModels.TGetGroupIntroductionViewModel | undefined
  >(undefined);

  const [groupNotesViewModel, setGroupNotesViewModel] = useState<
    viewModels.TGetGroupNotesViewModel | undefined
  >(undefined);

  const [nextSessionViewModel, setNextSessionViewModel] = useState<
    viewModels.TGetGroupNextCoachingSessionViewModel | undefined
  >(undefined);

  const [assignmentsViewModel, setAssignmentsViewModel] = useState<
    viewModels.TListGroupAssignmentsViewModel | undefined
  >(undefined);

  const [membersViewModel, setMembersViewModel] = useState<
    viewModels.TListGroupMembersViewModel | undefined
  >(undefined);


  const { presenter: groupIntroductionPresenter } = useGetGroupIntroductionPresenter(setGroupIntroductionViewModel);
  const { presenter: notesPresenter } = useGetGroupNotesPresenter(setGroupNotesViewModel);
  const { presenter: nextSessionPresenter } = useGetGroupNextCoachingSessionPresenter(setNextSessionViewModel);
  const { presenter: assignmentsPresenter } = useListGroupAssignmentsPresenter(setAssignmentsViewModel);
  const { presenter: membersPresenter } = useListGroupMembersPresenter(setMembersViewModel);


  // @ts-ignore
  groupIntroductionPresenter.present(groupIntroductionResponse, groupIntroductionViewModel);
  // @ts-ignore
  notesPresenter.present(groupNotesResponse, groupNotesViewModel);
  // @ts-ignore
  nextSessionPresenter.present(nextSessionResponse, nextSessionViewModel);
  // @ts-ignore
  assignmentsPresenter.present(assignmentsResponse, assignmentsViewModel);
  // @ts-ignore
  membersPresenter.present(membersResponse, membersViewModel);


  // Loading state - TODO: Implement proper loading state once ViewModels are added
  const isLoading = false; // Replace with: !groupNotesViewModel || !assignmentsViewModel || !membersViewModel || !nextSessionViewModel

  if (isLoading || !groupIntroductionViewModel || !groupNotesViewModel || !nextSessionViewModel || !assignmentsViewModel || !membersViewModel) {
    return <DefaultLoading locale={currentLocale} variant="minimal" />;
  }

  // Error handling - TODO: Implement error handling based on ViewModel modes
  // Example:
  // if (groupNotesViewModel?.mode === 'kaboom') {
  //   const errorData = groupNotesViewModel.data;
  //   console.error(errorData);
  //   return (
  //     <DefaultError
  //       locale={currentLocale}
  //       title={t('error.title')}
  //       description={t('error.description')}
  //     />
  //   );
  // }

  if (groupIntroductionViewModel.mode === 'kaboom' || groupNotesViewModel.mode === 'kaboom' || nextSessionViewModel.mode === 'kaboom' || assignmentsViewModel.mode === 'kaboom' || membersViewModel.mode === 'kaboom') {
    return (
      <DefaultError
        locale={currentLocale}
        title={t('error.title')}
        description={t('error.description')}
      />
    );
  }

  if (groupIntroductionViewModel.mode === 'not-found' || groupNotesViewModel.mode === 'not-found' || nextSessionViewModel.mode === 'not-found' || assignmentsViewModel.mode === 'not-found' || membersViewModel.mode === 'not-found') {
    return (
      <DefaultError
        locale={currentLocale}
        title={t('error.title')}
        description={t('error.description')}
      />
    );
  }

  // if (groupNotesViewModel?.mode === 'not-found') {
  //   const errorData = groupNotesViewModel.data;
  //   console.error(errorData);
  //   return (
  //     <DefaultNotFound
  //       locale={currentLocale}
  //       title={t('error.notFound.title')}
  //       description={t('error.notFound.description')}
  //     />
  //   );
  // }

  // Success state - TODO: Extract data from ViewModels
  const introductionData = groupIntroductionViewModel.data;
  const notesData = groupNotesViewModel.data;
  const nextSessionData = nextSessionViewModel.data;
  const assignmentsData = assignmentsViewModel.data;
  const membersData = membersViewModel.data;

  // Filter assignments based on filter criteria
  const filteredAssignments = assignmentsData.assignments.filter((assignment) => {
    // Title filter
    if (filters.title && !assignment.title.toLowerCase().includes(filters.title.toLowerCase())) {
      return false;
    }

    // Status filter
    if (filters.status && filters.status.length > 0 && !filters.status.includes(assignment.status)) {
      return false;
    }

    // Course filter
    if (filters.course && !assignment.course.title.toLowerCase().includes(filters.course.toLowerCase())) {
      return false;
    }

    // Module filter (assuming module is a number/ID)
    if (filters.module && !assignment.module.toString().toLowerCase().includes(filters.module.toLowerCase())) {
      return false;
    }

    // Lesson filter (assuming lesson is a number/ID)
    if (filters.lesson && !assignment.lesson.toString().toLowerCase().includes(filters.lesson.toLowerCase())) {
      return false;
    }

    // Student filter
    const studentFullName = `${assignment.student.name} ${assignment.student.surname}`.toLowerCase();
    if (filters.student && !studentFullName.includes(filters.student.toLowerCase())) {
      return false;
    }

    // Group filter
    if (filters.groupName && !assignment.groupName.toLowerCase().includes(filters.groupName.toLowerCase())) {
      return false;
    }

    return true;
  });

  // Sort assignments based on selected criteria
  const sortedAssignments = [...filteredAssignments].sort((a, b) => {
    switch (sortBy) {
      case 'title':
        return a.title.localeCompare(b.title);
      case 'status':
        // Sort by status priority: waiting-feedback, long-wait, course-completed
        const statusOrder = { 'waiting-feedback': 1, 'long-wait': 2, 'course-completed': 3 };
        return (statusOrder[a.status as keyof typeof statusOrder] || 999) - (statusOrder[b.status as keyof typeof statusOrder] || 999);
      case 'date':
        // Sort by latest activity (properly handle different lastReply types)
        const getReplyDate = (lastReply: typeof a.lastReply) => {
          if (!lastReply) return '';
          if (lastReply.replyType === 'reply') {
            return lastReply.sentAt;
          } else if (lastReply.replyType === 'passed') {
            return lastReply.passedAt;
          }
          return '';
        };

        const aDate = getReplyDate(a.lastReply);
        const bDate = getReplyDate(b.lastReply);
        return new Date(bDate).getTime() - new Date(aDate).getTime();
      case 'student':
        const aStudent = `${a.student.name} ${a.student.surname}`;
        const bStudent = `${b.student.name} ${b.student.surname}`;
        return aStudent.localeCompare(bStudent);
      default:
        return 0;
    }
  });

  const breadcrumbItems = [
    {
      label: breadcrumbsTranslations('home'),
      onClick: () => router.push(`/${locale}`),
    },
    {
      label: breadcrumbsTranslations('workspace'),
      onClick: () => router.push(`/${locale}/workspace`),
    },
    {
      label: breadcrumbsTranslations('yourCourses'),
      onClick: () => router.push(`/${locale}/workspace/courses`),
    },
    {
      label: courseSlug,
      onClick: () => router.push(`/${locale}/workspace/courses/${courseSlug}`),
    },
    {
      label: breadcrumbsTranslations('groups'),
      onClick: () => router.push(`/${locale}/workspace/courses/${courseSlug}/groups`),
    },
    {
      label: introductionData.name,
      onClick: () => router.push(`/${locale}/workspace/courses/${courseSlug}/groups/${groupId}`),
    },
  ];

  // Function to render StudentCard based on member data and status
  const renderStudentCard = (member: typeof membersData.members[0]) => {
    // Base props common to all student card variants
    const baseProps = {
      locale: locale,
      studentName: `${member.name} ${member.surname}`,
      studentImageUrl: member.avatarUrl || '',
      coachName: `${member.coach.name} ${member.coach.surname}`,
      coachImageUrl: member.coach.avatarUrl || '',
      courseName: member.course.title,
      courseImageUrl: member.course.imageUrl || '',
      coachingSessionsLeft: member.coachingSessionCount || undefined,
      isYou: member.coach.isCurrentUser,
      onStudentDetails: () => console.log("Click on student"),
      onClickCourse: () => console.log("Click on course"),
      onClickCoach: () => console.log("Click on coach"),
    };

    // Handle different status cases based on lastAssignment
    if (!member.lastAssignment) {
      // No assignment case
      return (
        <StudentCard
          {...baseProps}
          key={member.id}
          status="no-assignment"
        />
      );
    }

    const { status, title } = member.lastAssignment;

    if (status === "waiting-feedback") {
      return (
        <StudentCard
          {...baseProps}
          status="waiting-feedback"
          assignmentTitle={title}
          onViewAssignment={() => console.log("View assignment:", member.lastAssignment?.id)}
        />
      );
    }

    if (status === "long-wait") {
      return (
        <StudentCard
          {...baseProps}
          status="long-wait"
          assignmentTitle={title}
          onViewAssignment={() => console.log("View assignment:", member.lastAssignment?.id)}
        />
      );
    }

    if (status === "course-completed") {
      return (
        <StudentCard
          {...baseProps}
          status="course-completed"
          completedCourseDate={new Date()} // TODO: Add completion date from member data when available
        />
      );
    }

    // Fallback to no-assignment if status is unknown
    return (
      <StudentCard
        {...baseProps}
        status="no-assignment"
      />
    );
  };

  // Filter members based on search input
  const filteredMembers = membersData.members.filter((member) => {
    if (!search) return true; // Show all members if no search term

    const studentFullName = `${member.name} ${member.surname}`.toLowerCase();
    return studentFullName.includes(search.toLowerCase());
  });

  const statusMap: Record<string, "AwaitingReview" | "AwaitingForLongTime" | "Passed"> = {
    "waiting-feedback": "AwaitingReview",
    "long-wait": "AwaitingForLongTime",
    "course-completed": "Passed",
  };

  // Transform lastReply to replies array format
  const transformLastReplyToReplies = (lastReply: typeof assignmentsData.assignments[0]['lastReply']) => {
    if (!lastReply) return undefined;

    if (lastReply.replyType === "reply") {
      // Map reply type to resources type with files and links
      const transformedFiles = lastReply.files?.map(file => {
        const baseFile = {
          name: file.name,
          id: file.id,
          size: file.size,
          status: 'available' as const,
          url: file.downloadUrl,
        };

        if (file.category === 'image') {
          return {
            ...baseFile,
            category: 'image' as const,
            thumbnailUrl: file.thumbnailUrl,
          };
        } else if (file.category === 'video') {
          return {
            ...baseFile,
            category: 'video' as const,
            videoId: null,
            thumbnailUrl: file.thumbnailUrl,
          };
        } else if (file.category === 'document') {
          return {
            ...baseFile,
            category: 'document' as const,
          };
        } else {
          return {
            ...baseFile,
            category: 'generic' as const,
          };
        }
      });

      return [{
        type: "resources" as const,
        timestamp: lastReply.sentAt,
        sender: {
          name: lastReply.sender.name || lastReply.sender.username,
          email: lastReply.sender.username, // Using username as email fallback
          image: lastReply.sender.avatarUrl || '',
          id: lastReply.sender.id.toString(),
          role: lastReply.sender.role === 'coach' ? 'coach' as const : 'student' as const,
          isCurrentUser: false, // TODO: Determine if current user
        },
        comment: lastReply.comment,
        replyId: Date.now(), // Generate temporary ID since not provided
        links: lastReply.links?.map((link, index) => ({
          title: link.title,
          url: link.url,
          linkId: index, // Generate temporary ID
          customIcon: link.iconFile ? {
            name: link.iconFile.name,
            id: link.iconFile.id,
            size: link.iconFile.size,
            status: 'available' as const,
            category: link.iconFile.category,
            url: link.iconFile.downloadUrl,
            thumbnailUrl: null,
          } : undefined,
        })),
        files: transformedFiles,
      }];
    } else if (lastReply.replyType === "passed") {
      // Map passed type
      return [{
        type: "passed" as const,
        timestamp: lastReply.passedAt,
        sender: {
          name: lastReply.sender.name || lastReply.sender.username,
          email: lastReply.sender.username, // Using username as email fallback
          image: lastReply.sender.avatarUrl || '',
          id: lastReply.sender.id.toString(),
          role: lastReply.sender.role === 'coach' ? 'coach' as const : 'student' as const,
          isCurrentUser: false, // TODO: Determine if current user
        },
        replyId: Date.now(), // Generate temporary ID since not provided
      }];
    }

    return undefined;
  };

  return (
    <div className="flex flex-col space-y-10">
      {/* Section: Group Introduction */}
      <div className='flex flex-col gap-4'>
        <div className='flex flex-col gap-3'>
          <Breadcrumbs items={breadcrumbItems} />
          <h5 className='text-text-primary md:text-lg text-md font-bold leading-[120%]'>
            {t('title')}
          </h5>
          <p className='text-text-secondary text-sm md:text-md'>
            {t('description')}
          </p>
        </div>
        <GroupIntroduction
          groupName={introductionData.name}
          courseName={introductionData.course.title}
          // TODO: In getGroupIntroduction response we need single coach instead of array
          isYou={introductionData.coaches[0].isCurrentUser}
          coachName={`${introductionData.coaches[0].name} ${introductionData.coaches[0].surname}`}
          courseImageUrl={introductionData.course.imageUrl || ''}
          coachImageUrl={introductionData.coaches[0].avatarUrl || ''}
          actualStudentCount={introductionData.actualStudentCount}
          maxStudentCount={introductionData.maxStudentCount}
          locale={locale}
          onClickCourse={() => router.push(`/${locale}/workspace/courses/${courseSlug}`)}
          onClickUser={() => {
            // TODO: Navigate to coach profile page
          }}
        />
      </div>

      {/* TODO: Implement sections based on Notion features */}

      {/* Section: Group Notes (saveGroupNotes, getGroupNotes) */}
      {/* <section> */}
      {/* <h2>{t('notes.title')}</h2> */}
      {/* TODO: Implement notes editor with save functionality */}
      {/* TODO: Use saveGroupNotes usecase for saving */}
      {/* TODO: Display notes from getGroupNotes usecase */}
      {/* Example save button: */}
      {/* <button onClick={handleSaveNotes}>{t('notes.saveButton')}</button> */}
      {/* </section> */}
      <div className="flex gap-4 items-start w-full flex-col md:flex-row lg:flex-row">
        {/* Notes section*/}
        <div className='flex flex-col gap-4 w-full'>
        <h3 className='text-text-primary md:text-2xl text-xl font-bold leading-[110%] text-left'>
            {t('notes.title')}
        </h3>
          <CoachNotesView
            noteDescription={notesData.notes}
            // TODO: Change this mapping once notesData.links structure matches with CoachNotesView props
            noteLinks={notesData.links?.map(link => ({
              url: link.url || '',
              title: link.title,
              customIconMetadata: link.icon ? {
                id: link.icon.id,
                name: link.icon.name,
                size: link.icon.size,
                status: 'available' as const,
                category: link.icon.category,
                url: link.icon.downloadUrl,
                thumbnailUrl: null,
              } : undefined,
            }))}
            locale="en"
            onExploreCourses={() => alert('onExploreCourses')}
          />
        </div>

        {/* Next coaching session */}
        <div className='flex flex-col gap-4 md:w-fit lg:w-fit w-full'>
          <div className='flex items-center justify-between w-full gap-7'>
            <h3 className='text-text-primary md:text-2xl text-xl font-bold leading-[110%] whitespace-nowrap'>
              {t('nextCoachingSession.title')}
            </h3>
            <Button
              variant="text"
              text={t('nextCoachingSession.closedSessionsButton')}
              onClick={() => {
                // TODO: Implement view closed sessions functionality
              }}
            />
          </div>
          {/* Group Coaching Sessions */}
          {nextSessionData.nextSession ? (
            <CoachingSessionGroupOverviewCard 
              userType='student'
              status='unscheduled'
              withinCourse={false}
              creatorName=''
              creatorImageUrl=''
              onClickCreator={() => console.log('Click creator')}
              locale={locale}
              title={nextSessionData.nextSession.coachingOfferingTitle}
              duration={nextSessionData.nextSession.coachingOfferingDuration}
            />
          ) : (
            <div className='flex items-center justify-center py-16'>
              <p className='text-text-secondary text-sm md:text-md'>
                {t('nextCoachingSession.noSession')}
              </p>
            </div>
          )}
        </div>
      </div>

      {/* Section: Group Assignments (listGroupAssignments) */}
      <div className="flex flex-col gap-4 w-full">
        <div className='flex items-center justify-between w-full flex-wrap gap-4'>
          <h3 className='text-text-primary md:text-2xl text-xl font-bold leading-[110%]'>
            {t('assignments.title')}
          </h3>
          <div className="flex items-center gap-2 flex-wrap">
            <div className="flex items-center gap-2 md:w-fit lg:w-fit w-full justify-between">
              <p className="text-sm text-text-primary">
                {t('assignments.sortBy')}
              </p>
              <div className="w-48">
                <Dropdown
                  type="simple"
                  options={sortOptions}
                  onSelectionChange={handleSortChange}
                  defaultValue={sortBy}
                  text={{ simpleText: t('assignments.selectSort') }}
                />
              </div>
            </div>
            <div className="flex items-center gap-2 md:w-fit lg:w-fit w-full justify-between">
              <Button
                variant="secondary"
                size="medium"
                text={t('assignments.filterButton')}
                onClick={() => setShowFilterModal(true)}
                hasIconLeft
                iconLeft={<IconFilter />}
                className="w-auto"
              />
              <Button
                variant="primary"
                size="medium"
                text={t('assignments.downloadAllButton')}
                onClick={() => console.log('Download all button clicked')}
                className="w-auto"
              />
            </div>
          </div>
        </div>
        <div className='grid md:grid-cols-2 lg:grid-cols-3 gap-6 w-full'>
          {sortedAssignments.map((assignment) => (
            <AssignmentCard
              key={assignment.id}
              role='coach'
              assignmentId={assignment.id}
              title={assignment.title}
              // TODO: Add description field in listGroupAssignments usecase response
              description={assignment.title}
              // TODO: Add files field (Files uploaded by coach) if no reply is available in listGroupAssignments usecase response
              // files={assignment.files}
              // TODO: Add links field (Links uploaded by coach) if no reply is available in listGroupAssignments usecase response
              // links={assignment.links}
              // TODO: There is type difference between assignment.course in usecase and AssignmentCard props
              // @ts-ignore
              course={assignment.course}
              module={assignment.module}
              lesson={assignment.lesson}
              // TODO: There is type difference between assignment.reply in usecase and AssignmentCard props
              status={statusMap[assignment.status]}
              student={{
                role: 'student',
                id: assignment.student.id.toString(),
                name: `${assignment.student.name} ${assignment.student.surname}`,
                image: assignment.student.avatarUrl || '',
                // TODO: Add email field in listGroupAssignments usecase response
                email: '',
                isCurrentUser: false,
              }}
              groupName={assignment.groupName}
              // TODO: There is type difference between assignment.lastReply in usecase and AssignmentCard props
              replies={transformLastReplyToReplies(assignment.lastReply)}
              locale={locale}
              onFileDelete={(assignmentId, fileId) => console.log("File deleted:", assignmentId, fileId)}
              onLinkDelete={(assignmentId, linkId) => console.log("Link deleted:", assignmentId, linkId)}
              onFileDownload={(id) => console.log("Download file:", id)}
              linkEditIndex={0}
              // onImageChange={(fileRequest, abortSignal) => {
              //   // TODO: Implement image change functionality
              // }}
              onDeleteIcon={(id) => console.log("Delete Icon", id)}
              // onChange={() => {
              //   // TODO: Implement onchange functionality
              // }}
              onClickCourse={() => router.push(`/${locale}/workspace/courses/${courseSlug}`)}
              onClickUser={() => {
                // TODO: Implement routing for user click
              }}
              onClickGroup={() => {
                // TODO: Implement routing for group click
              }}
              onClickView={() => {
                // TODO: Implement handle click
              }}
            />
          ))}
        </div>
      </div>

      {/* Section: Group Members (listGroupMembers) */}
      <div className='flex flex-col gap-4 w-full'>
        <div className='flex items-center justify-between w-full flex-wrap gap-4'>
          <h3 className='text-text-primary md:text-2xl text-xl font-bold items-center'>
            {t('members.title')}
          </h3>
          <div className='flex w-full md:w-fit lg:w-fit'>
            <div className='flex-1'>
              <TextInput
                inputField={{
                  id: 'search',
                  className: 'w-full',
                  value: search,
                  setValue: setSearch,
                  inputText: t('members.searchstudent'),
                  hasLeftContent: true,
                  leftContent: <IconSearch />,
                }}
              />
            </div>
          </div>
        </div>
        <StudentCardList locale={locale}>
          {filteredMembers.map((member) => renderStudentCard(member))}
        </StudentCardList>
      </div>

      {/* Assignment Filter Modal */}
      {showFilterModal && (
        <AssignmentCardFilterModal
          onApplyFilters={handleApplyFilters}
          onClose={() => setShowFilterModal(false)}
          initialFilters={filters}
          availableStatuses={['waiting-feedback', 'long-wait', 'course-completed']}
          availableCourses={[...new Set(assignmentsData.assignments.map(a => a.course.title))]}
          availableModules={[...new Set(assignmentsData.assignments.map(a => a.module.toString()))]}
          availableLessons={[...new Set(assignmentsData.assignments.map(a => a.lesson.toString()))]}
          locale={locale}
        />
      )}
    </div>
  );
}
